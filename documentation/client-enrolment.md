# Client Enrolment Process

This document describes the process to securely enrol a client into the management system.

## 1. Generate Token
To enrol a client, a 16 digit token will be generated by the administrator from the dashboard. This serves a number of purposes:
 - Ensures clients can only join with permission from an administrator - they cannot be added without the token.
 - Identifies clients against specific labels/tags
 - Limiting how many clients can be enrolled or expiring the enrolment token

The token is generated using `crypto.randomBytes(8).toString("hex")`

## 2. Command Line Generated
The dashboard generates a script file that can be run on clients.

```sh
#!/bin/bash

# Verify script is running as root
if [ "$EUID" -ne 0 ]
  then echo "Please run as root"
  exit
fi

now=$(date +%Y-%m-%d_%H_%M_%S)

filename="/tmp/client_linux_$now.sh"

# Download script from server
wget https://server.address/clients/linux.sh -o $filename

# Make the script executable
chmod +x $filename

# Run the script
$filename "server.address" "dc1f37db757ba34c"
```

## 3. Client Enrols with server
1. Attempts to connect to server using address.
2. Attempts to verify token against server.
3. Attempts to establish secure relationship with server.
4. **Only** after all of the above successful, then the client will install onto the client.